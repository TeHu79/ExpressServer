<!DOCTYPE html>

<html>
<head>
    <title>Herkut</title>
    <link rel="stylesheet" href="style.css"/>
</head>

<body>
    <center>
        <div id="pin-div">
            <input id="pin" placeholder="pin code" type="password" />
            <button onclick="checkPin()">login</button>
        </div>


    <h1 class="hidden">Herkkuja</h1>

    <div class="hidden" id="sisältö"></div>
    </body>
    </center>

    <script>
        //---------pin koodin tarkistus----------------
        async function checkPin() {
        var pin = document.getElementById("pin").value
        const response = await fetch("http://localhost:3000/api/getpin")
        const correctPin = await response.json()

        if (pin == correctPin) {
        var hiddenElements = document.getElementsByClassName("hidden")
        
        for (i=0; i < hiddenElements.length; i++){
        hiddenElements[i].style.visibility = "visible"

        document.getElementById("pin-div").style.visibility = "hidden"
        }
        }
        else {
            alert("Väärä pinkoodi")
       }
    }

        
    //------------------- Datan haku-----------------------

        async function fetchData() {                
        document.getElementById("sisältö").innerHTML = "<h4>Ladataan herkkuja...</h4>"

        var x =`<table><thead><th>Herkun nimi</th><th>tuotekoodi</th></thead><tbody>`
            
        try {

        const response = await fetch("http://localhost:3000/api/herkut")

        const herkkudata = await response.json() // muutetaan json => javascript muotoon

        await herkkudata.map(h => { // loopataan läpi oliot map funktiolla, ha on 1 herkkuolio
        x += `<tr><td>${h.name}</td><td>${h.id}</td></tr>`
        })

        //taulukko päätetään ja renderöidään html elementtiin

        x += `</tbody></table>`
        document.getElementById("sisältö").innerHTML = x

        //Virhetilanteen hallinta
        } catch (error){
            console.error("Error fetching data:", error)

        }

        }

        fetchData()
    </script>

</body>
</html>